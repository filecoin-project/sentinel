{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": 4,
  "links": [],
  "panels": [
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "description": "",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "links": []
        },
        "overrides": []
      },
      "fill": 3,
      "fillGradient": 0,
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "hiddenSeries": false,
      "id": 22,
      "legend": {
        "alignAsTable": true,
        "avg": true,
        "current": false,
        "hideEmpty": false,
        "max": true,
        "min": true,
        "rightSide": true,
        "show": false,
        "total": false,
        "values": true
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null as zero",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 0.5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "Failure",
          "color": "#E02F44"
        },
        {
          "alias": "Success",
          "color": "#96D98D"
        }
      ],
      "spaceLength": 10,
      "stack": true,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": false,
          "rawSql": "SELECT\n  \"time\" AS \"time\",\n  counter - lag(counter) OVER (ORDER BY \"time\") AS \"Failure\"\nFROM lotus_message_failure\nWHERE\n  $__timeFilter(\"time\")\nORDER BY 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              },
              {
                "params": [
                  "delta"
                ],
                "type": "window"
              },
              {
                "params": [
                  "Failure"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "lotus_message_failure",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamptz",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": false,
          "rawSql": "SELECT\n  \"time\" AS \"time\",\n  counter - lag(counter) OVER (ORDER BY \"time\") AS \"Success\"\nFROM lotus_message_success\nWHERE\n  $__timeFilter(\"time\")\nORDER BY 1",
          "refId": "B",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              },
              {
                "params": [
                  "delta"
                ],
                "type": "window"
              },
              {
                "params": [
                  "Success"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "lotus_message_success",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamptz",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Messages Recieved",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": null,
          "format": "short",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": "0",
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "description": "Number of peers connected to the lotus node.",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "links": []
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "hiddenSeries": false,
      "id": 24,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": false,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"time\" AS \"time\",\n  gauge\nFROM lotus_peer_count\nWHERE\n  $__timeFilter(\"time\")\nORDER BY 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "gauge"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_peer_count",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamptz",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Connected Peers Count",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "datasource": null,
      "description": "Total Tipsets/Blocks on Chain",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "7.1.5",
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  NOW() AS \"time\",\n  count(*) AS \"Blocks\"\nFROM \"block_headers\"",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "\"chain.economics\"",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  NOW() AS \"time\",\n  max(height) AS \"Tipsets\"\nFROM \"block_headers\"",
          "refId": "B",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_rpc_response_error",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  NOW() AS \"time\",\n  count(cid)::float/max(height)::float AS \"Block/Tipset Ratio\"\nFROM \"block_headers\"",
          "refId": "C",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_rpc_response_error",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "",
      "type": "stat"
    },
    {
      "alert": {
        "alertRuleTags": {},
        "conditions": [
          {
            "evaluator": {
              "params": [],
              "type": "no_value"
            },
            "operator": {
              "type": "and"
            },
            "query": {
              "params": [
                "A",
                "1m",
                "now"
              ]
            },
            "reducer": {
              "params": [],
              "type": "last"
            },
            "type": "query"
          }
        ],
        "executionErrorState": "keep_state",
        "for": "2m",
        "frequency": "1m",
        "handler": 1,
        "message": "Blocks production has halted on network for 2 minutes. Please investigate immediately.",
        "name": "Sustained Null Blocks",
        "noDataState": "alerting",
        "notifications": [
          {
            "uid": "F7zrp_GGk"
          }
        ]
      },
      "aliasColors": {},
      "bars": true,
      "dashLength": 10,
      "dashes": false,
      "datasource": "TimescaleDB",
      "decimals": 0,
      "description": "Number of blocks reported by network by Miner ID.",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "links": []
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 5,
        "w": 20,
        "x": 0,
        "y": 4
      },
      "hiddenSeries": false,
      "id": 2,
      "interval": "30s",
      "legend": {
        "alignAsTable": true,
        "avg": false,
        "current": false,
        "hideZero": true,
        "max": false,
        "min": false,
        "rightSide": true,
        "show": true,
        "sort": "total",
        "sortDesc": true,
        "total": true,
        "values": true
      },
      "lines": false,
      "linewidth": 1,
      "nullPointMode": "null as zero",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": true,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [
            {
              "params": [
                "$__interval",
                "none"
              ],
              "type": "time"
            },
            {
              "params": [
                "$__interval",
                "none"
              ],
              "type": "time"
            }
          ],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "WITH \"elections\" AS (\n  SELECT\n    to_timestamp(\"timestamp\") AS \"time\",\n    miner AS \"miner\"\n  FROM \"block_headers\"\n  WHERE\n    $__unixEpochFilter(\"timestamp\")\n)\nSELECT\n  $__timeGroupAlias(\"time\",$__interval,0),\n  miner AS \"metric\",\n  max(1) AS \"election\"\nFROM \"elections\"\nWHERE\n  $__timeFilter(\"time\")\nGROUP BY 1, 2\nORDER BY 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "miner_tag"
                ],
                "type": "column"
              },
              {
                "params": [
                  "avg"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "miner"
                ],
                "type": "alias"
              }
            ],
            [
              {
                "params": [
                  "1"
                ],
                "type": "column"
              },
              {
                "params": [
                  "avg"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "election"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "\"chain.block\"",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Reported Blocks",
      "tooltip": {
        "shared": true,
        "sort": 2,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": 0,
          "format": "short",
          "label": "blocks won",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "datasource": null,
      "description": "Time elapsed since last block found.",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 30
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 4,
        "x": 20,
        "y": 4
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "7.1.5",
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  NOW() AS \"time\",\n  extract(epoch from NOW() - to_timestamp(\"timestamp\")) AS \"since_last_block\"\nFROM \"block_headers\"\nORDER BY 2 ASC\nLIMIT 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "\"chain.economics\"",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Time since Last Block",
      "type": "stat"
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "decimals": 3,
      "description": "Parent Base Fee of the chain over time.",
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 10,
        "w": 17,
        "x": 0,
        "y": 9
      },
      "hiddenSeries": false,
      "id": 31,
      "legend": {
        "alignAsTable": true,
        "avg": true,
        "current": true,
        "max": true,
        "min": true,
        "rightSide": false,
        "show": true,
        "total": false,
        "values": true
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "gas/sec",
          "color": "#96D98D",
          "yaxis": 2
        },
        {
          "alias": "gas 5 min avg/sec",
          "color": "#C8F2C2",
          "yaxis": 2
        },
        {
          "alias": "Base Fee (gas)",
          "color": "#FA6400"
        },
        {
          "alias": "Base Fee (gas, 5 min avg)",
          "color": "#FFB357"
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "WITH fee_plus_avg AS (\n\tSELECT\n\t\tb.timestamp as \"time\",\n\t\tb.parent_base_fee::numeric,\n\t\tavg(b.parent_base_fee::numeric) over (order by timestamp desc rows between 10 preceding and current row) as \"5_min_avg\"\n\tFROM block_headers b\n\tJOIN (\n\t\tSELECT\n\t\t\theight,\n\t\t\tmax(block_headers.parent_weight) parent_weight\n\t\tFROM block_headers\n\t\tGROUP BY 1\n\t) max_weight_by_height ON max_weight_by_height.height = b.height AND max_weight_by_height.parent_weight = b.parent_weight\n\tWHERE\n\t  $__unixEpochFilter(b.timestamp)\n\tGROUP BY 1, 2\n\tORDER BY 1 desc\n) SELECT\n\ttime,\n\tparent_base_fee as \"Base Fee (gas)\",\n\t\"5_min_avg\" as \"Base Fee (gas, 5 min avg)\",\n\t(parent_base_fee - lag(parent_base_fee) over (order by time asc)) /\n\t\t(time - lag(time) over (order by time asc)) as \"gas/sec\",\n\t(\"5_min_avg\" - lag(\"5_min_avg\") over (order by time asc)) /\n\t\t(time - lag(time) over (order by time asc)) as \"gas 5 min avg/sec\"\n\t\nfrom fee_plus_avg\norder by 1;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [
        {
          "colorMode": "custom",
          "fill": false,
          "fillColor": "rgba(51, 162, 229, 0.2)",
          "line": true,
          "lineColor": "rgba(255, 255, 255, 0.6)",
          "op": "gt",
          "value": 0,
          "yaxis": "right"
        }
      ],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Parent Base Fee",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "sci",
          "label": "",
          "logBase": 10,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "sci",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": true,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "description": "Total message size found.",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "links": []
        },
        "overrides": []
      },
      "fill": 5,
      "fillGradient": 0,
      "gridPos": {
        "h": 5,
        "w": 7,
        "x": 17,
        "y": 9
      },
      "hiddenSeries": false,
      "id": 25,
      "interval": "45m",
      "legend": {
        "alignAsTable": true,
        "avg": true,
        "current": false,
        "max": true,
        "min": true,
        "rightSide": false,
        "show": true,
        "total": true,
        "values": true
      },
      "lines": false,
      "linewidth": 1,
      "nullPointMode": "null as zero",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [
            {
              "params": [
                "$__interval",
                "none"
              ],
              "type": "time"
            }
          ],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "WITH message_per_epoch AS (\n\tSELECT\n\t  to_timestamp(\"b\".\"timestamp\") AS \"time\",\n\t  count(*) AS \"total\"\n\tFROM \"messages\" m\n\tJOIN \"block_messages\" bm ON m.cid = bm.message\n\tJOIN \"block_headers\" b ON bm.block = b.cid\n\tWHERE\n\t   $__unixEpochFilter(\"b\".\"timestamp\")\n\tGROUP BY 1\n\tORDER BY 1\n)\nSELECT\n  $__timeGroupAlias(\"time\",'30s'),\n  total AS \"Total Messages\"\nFROM message_per_epoch\nWHERE\n  $__timeFilter(\"time\")\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "column"
              },
              {
                "params": [
                  "avg"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "\"chain.economics\"",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Total Messages",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": 0,
          "format": "none",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "description": "Shows message sizes as each message is included on-chain.",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "links": []
        },
        "overrides": []
      },
      "fill": 0,
      "fillGradient": 0,
      "gridPos": {
        "h": 5,
        "w": 7,
        "x": 17,
        "y": 14
      },
      "hiddenSeries": false,
      "id": 8,
      "interval": "30s",
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": false,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 2,
      "nullPointMode": "null as zero",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "Maximum",
          "fillBelowTo": "Minimum",
          "lines": false
        },
        {
          "alias": "Average",
          "color": "rgb(223, 239, 255)"
        },
        {
          "alias": "Minimum",
          "lines": false
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [
            {
              "params": [
                "$__interval",
                "none"
              ],
              "type": "time"
            }
          ],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "WITH message_sizes AS (\n\tSELECT \n\t\tto_timestamp(b.timestamp) AS \"time\",\n\t\tm.size_bytes AS \"message_bytes\"\n\tFROM \"messages\" m\n\tJOIN \"block_messages\" bm ON m.cid = bm.message\n\tJOIN \"block_headers\" b ON b.cid = bm.block\n\tWHERE\n\t  $__unixEpochFilter(\"b\".\"timestamp\")\n)\nSELECT\n  $__timeGroupAlias(\"message_sizes\".\"time\",$__interval),\n  min(message_bytes) AS \"Minimum\",\n  avg(message_bytes) AS \"Average\",\n  max(message_bytes) AS \"Maximum\",\n  sum(message_bytes) AS \"Sum\"\nFROM \"message_sizes\"\nGROUP BY 1\nORDER BY 1;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "column"
              },
              {
                "params": [
                  "avg"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "\"chain.economics\"",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Message Size",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": 0,
          "format": "decbytes",
          "label": "bytes",
          "logBase": 10,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": "count",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "cards": {
        "cardPadding": 0,
        "cardRound": null
      },
      "color": {
        "cardColor": "#96D98D",
        "colorScale": "sqrt",
        "colorScheme": "interpolateGreens",
        "exponent": 0.8,
        "max": null,
        "mode": "opacity"
      },
      "dataFormat": "tsbuckets",
      "datasource": null,
      "description": "Duration reported by lotus between receipt and validation of a block.",
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "gridPos": {
        "h": 10,
        "w": 17,
        "x": 0,
        "y": 19
      },
      "heatmap": {},
      "hideZeroBuckets": true,
      "highlightCards": true,
      "id": 20,
      "interval": "30s",
      "legend": {
        "show": true
      },
      "reverseYBuckets": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"time\",\n  -- \"0.01\" - LAG(\"0.01\") OVER (ORDER BY \"time\") AS \"0.01\",\n  -- \"0.05\" - LAG(\"0.05\") OVER (ORDER BY \"time\") AS \"0.05\",\n  -- \"0.1\" - LAG(\"0.1\") OVER (ORDER BY \"time\") AS \"0.1\",\n  -- \"0.3\" - LAG(\"0.3\") OVER (ORDER BY \"time\") AS \"0.3\",\n  -- \"0.6\" - LAG(\"0.6\") OVER (ORDER BY \"time\") AS \"0.6\",\n  -- \"0.8\" - LAG(\"0.8\") OVER (ORDER BY \"time\") AS \"0.8\",\n  -- \"1\" - LAG(\"1\") OVER (ORDER BY \"time\") AS \"1\",\n  -- \"2\" - LAG(\"2\") OVER (ORDER BY \"time\") AS \"2\",\n  -- \"3\" - LAG(\"3\") OVER (ORDER BY \"time\") AS \"3\",\n  -- \"4\" - LAG(\"4\") OVER (ORDER BY \"time\") AS \"4\",\n  -- \"5\" - LAG(\"5\") OVER (ORDER BY \"time\") AS \"5\",\n  -- \"6\" - LAG(\"6\") OVER (ORDER BY \"time\") AS \"6\",\n  -- \"8\" - LAG(\"8\") OVER (ORDER BY \"time\") AS \"8\",\n  -- \"10\" - LAG(\"10\") OVER (ORDER BY \"time\") AS \"10\",\n  -- \"13\" - LAG(\"13\") OVER (ORDER BY \"time\") AS \"13\",\n  -- \"16\" - LAG(\"16\") OVER (ORDER BY \"time\") AS \"16\",\n  \"20\" - LAG(\"20\") OVER (ORDER BY \"time\") AS \"20\",\n  \"25\" - LAG(\"25\") OVER (ORDER BY \"time\") AS \"25\",\n  \"30\" - LAG(\"30\") OVER (ORDER BY \"time\") AS \"30\",\n  \"40\" - LAG(\"40\") OVER (ORDER BY \"time\") AS \"40\",\n  \"50\" - LAG(\"50\") OVER (ORDER BY \"time\") AS \"50\",\n  \"65\" - LAG(\"65\") OVER (ORDER BY \"time\") AS \"65\",\n  \"80\" - LAG(\"80\") OVER (ORDER BY \"time\") AS \"80\",\n  \"100\" - LAG(\"100\") OVER (ORDER BY \"time\") AS \"100\",\n  \"130\" - LAG(\"130\") OVER (ORDER BY \"time\") AS \"130\",\n  \"160\" - LAG(\"160\") OVER (ORDER BY \"time\") AS \"160\",\n  \"200\" - LAG(\"200\") OVER (ORDER BY \"time\") AS \"200\",\n  \"250\" - LAG(\"250\") OVER (ORDER BY \"time\") AS \"250\",\n  \"300\" - LAG(\"300\") OVER (ORDER BY \"time\") AS \"300\",\n  \"400\" - LAG(\"400\") OVER (ORDER BY \"time\") AS \"400\",\n  \"500\" - LAG(\"500\") OVER (ORDER BY \"time\") AS \"500\",\n  \"650\" - LAG(\"650\") OVER (ORDER BY \"time\") AS \"650\",\n  \"800\" - LAG(\"800\") OVER (ORDER BY \"time\") AS \"800\",\n  \"1000\" - LAG(\"1000\") OVER (ORDER BY \"time\") AS \"1000\",\n  \"2000\" - LAG(\"2000\") OVER (ORDER BY \"time\") AS \"2000\",\n  \"5000\" - LAG(\"5000\") OVER (ORDER BY \"time\") AS \"5000\",\n  \"10000\" - LAG(\"10000\") OVER (ORDER BY \"time\") AS \"10000\",\n  \"20000\" - LAG(\"20000\") OVER (ORDER BY \"time\") AS \"20000\",\n  \"50000\" - LAG(\"50000\") OVER (ORDER BY \"time\") AS \"50000\",\n  \"100000\" - LAG(\"100000\") OVER (ORDER BY \"time\") AS \"100000\"\nFROM lotus_block_validation_ms\nWHERE\n  $__timeFilter(\"time\")\nORDER BY 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "\"0.1\""
                ],
                "type": "column"
              },
              {
                "params": [
                  "delta"
                ],
                "type": "window"
              },
              {
                "params": [
                  "0.01"
                ],
                "type": "alias"
              }
            ],
            [
              {
                "params": [
                  "\"0.3\""
                ],
                "type": "column"
              },
              {
                "params": [
                  "delta"
                ],
                "type": "window"
              },
              {
                "params": [
                  "0.05"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "lotus_block_validation_ms",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamptz",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Block Validation Time",
      "tooltip": {
        "show": true,
        "showHistogram": true
      },
      "tooltipDecimals": 0,
      "type": "heatmap",
      "xAxis": {
        "show": true
      },
      "xBucketNumber": 60,
      "xBucketSize": "",
      "yAxis": {
        "decimals": null,
        "format": "ms",
        "logBase": 1,
        "max": null,
        "min": null,
        "show": true,
        "splitFactor": null
      },
      "yBucketBound": "lower",
      "yBucketNumber": 24,
      "yBucketSize": null
    },
    {
      "alert": {
        "alertRuleTags": {},
        "conditions": [
          {
            "evaluator": {
              "params": [
                0.25
              ],
              "type": "gt"
            },
            "operator": {
              "type": "and"
            },
            "query": {
              "params": [
                "A",
                "48h",
                "now"
              ]
            },
            "reducer": {
              "params": [],
              "type": "avg"
            },
            "type": "query"
          }
        ],
        "executionErrorState": "alerting",
        "for": "10m",
        "frequency": "2m",
        "handler": 1,
        "name": "Deal Terminations alert",
        "noDataState": "no_data",
        "notifications": []
      },
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 10
              }
            ]
          },
          "unit": "Misc"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "percent"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percentunit"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "total"
            },
            "properties": [
              {
                "id": "unit",
                "value": "short"
              }
            ]
          }
        ]
      },
      "fill": 1,
      "fillGradient": 3,
      "gridPos": {
        "h": 7,
        "w": 7,
        "x": 17,
        "y": 19
      },
      "hiddenSeries": false,
      "id": 29,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null as zero",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "total",
          "yaxis": 2
        },
        {
          "alias": "percent",
          "color": "#F2495C"
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "with epoch as (\n    select height,\n           time_bucket('30s', to_timestamp(block_headers.timestamp)) as \"time\",\n           parent_state_root\n    from block_headers\n    where to_timestamp(timestamp) > date $__timeFrom() - interval '3 hour'\n     and to_timestamp(timestamp) < $__timeTo()\n    group by timestamp, height, parent_state_root, parent_weight\n    order by height desc, parent_weight desc\n),\n     deal_terminations_per_height as (\n         select epoch.time,\n                sum(count(mdp.deal_id) filter (where slash_epoch > 0 and slash_epoch is not null)) over (order by epoch.time rows between 360 preceding and current row) as \"terminated\",\n                sum(count(mdp.deal_id)) over (order by epoch.time rows between 360 preceding and current row) as \"total\"\n         from epoch\n                  left join market_deal_states mds on epoch.parent_state_root = mds.state_root\n                  left join market_deal_proposals mdp on mds.deal_id = mdp.deal_id\n         group by epoch.time\n         order by epoch.time desc\n     )\nselect distinct on (time) time,\n                          total,\n                          (case when total = '0' then 0 else terminated/total end) as \"percent\"\nfrom deal_terminations_per_height\nwhere time > $__timeFrom()\n  and time < $__timeTo()\norder by time desc",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [
        {
          "colorMode": "critical",
          "fill": true,
          "line": true,
          "op": "gt",
          "value": 0.25,
          "yaxis": "left"
        }
      ],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Deal Terminations",
      "tooltip": {
        "shared": true,
        "sort": 2,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "percentunit",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": "0",
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": "0",
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "alert": {
        "alertRuleTags": {},
        "conditions": [
          {
            "evaluator": {
              "params": [
                5
              ],
              "type": "gt"
            },
            "operator": {
              "type": "and"
            },
            "query": {
              "params": [
                "A",
                "5m",
                "now"
              ]
            },
            "reducer": {
              "params": [],
              "type": "max"
            },
            "type": "query"
          },
          {
            "evaluator": {
              "params": [
                100
              ],
              "type": "gt"
            },
            "operator": {
              "type": "or"
            },
            "query": {
              "params": [
                "A",
                "24h",
                "now"
              ]
            },
            "reducer": {
              "params": [],
              "type": "sum"
            },
            "type": "query"
          }
        ],
        "executionErrorState": "alerting",
        "for": "3m",
        "frequency": "1m",
        "handler": 1,
        "message": "Null Tipsets are being detected on-chain. This could be related to network health or failing infrastructure.\n\nCheck Network Health:\n- Drand outage?\n- Network is well-connected?\n\nValidate Infrastructure Health and Data Accuracy:\n- Lotus node supporting Sentinel is running normally.\n- Chainwatch/Visor is running normally.\n- Check `lotus chain list` to see if it matches Sentinel views.",
        "name": "Consecutive Null Rounds",
        "noDataState": "keep_state",
        "notifications": []
      },
      "aliasColors": {},
      "bars": true,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "description": "All heights where a series of null rounds were concluded and the height at which they concluded.",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "center",
            "displayMode": "auto"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 6,
        "w": 7,
        "x": 17,
        "y": 26
      },
      "hiddenSeries": false,
      "hideTimeOverride": false,
      "id": 34,
      "interval": "",
      "legend": {
        "avg": false,
        "current": true,
        "max": true,
        "min": false,
        "show": true,
        "total": true,
        "values": true
      },
      "lines": false,
      "linewidth": 1,
      "nullPointMode": "null",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": true,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "WITH distinct_heights AS (\n  /* add row for end height to terminate null rounds comparisons which end\n  ahead of the query window, or are occurring in real-time */\n\t(\n  \tSELECT $__unixEpochTo() as \"timestamp\",\n  \t(($__unixEpochTo() - block_headers.timestamp) / 30)::INTEGER as \"height\"\n    FROM block_headers\n    WHERE block_headers.height = 0 LIMIT 1\n\t)\n\t  UNION\n\t  /* always add the latest row from which to start counting\n\t     consecutive null rounds in case the query window does\n\t     not naturally include them */\n\t(\n  \tSELECT timestamp, height::int\n  \tFROM block_headers\n  \tORDER BY timestamp DESC\n  \tLIMIT 1\n\t)\n\t\tUNION\n\t/* select all distinct heights and their timestamps */\n\t(\n  \tSELECT\n  \t\ttimestamp,\n  \t\theight::int AS height\n  \tFROM\n  \t\tblock_headers\n  \tWHERE $__unixEpochFilter(\"timestamp\")\n  \tGROUP BY 1, 2\n\t)\n\tORDER BY\n\t\theight DESC\n\n),\nheight_diffs AS (\n  /* assuming at least two rows in this result, the difference in heights\n     are calculated for each row minus the height of the row prior, which\n     will count the number of heights skipped in the blocks table\n  */\n\tSELECT\n\t\tto_timestamp(timestamp) AS \"time\",\n\t\theight,\n\t\theight - lag(height) OVER (ORDER BY height) - 1 AS \"consecutive_null_rounds\"\n\tFROM\n\t\tdistinct_heights ORDER BY\n\t\t\theight DESC\n)\nSELECT\n  /* quantize data to 30 second intervals selecting the maximum consecutive\n     null rounds which terminate within that interval */\n  time_bucket_gapfill('30s',\"time\") as \"time\",\n\tmax(hd.consecutive_null_rounds) as \"Consecutive Null Rounds\"\nFROM\n\theight_diffs hd\nWHERE\n\tconsecutive_null_rounds > 0\n\tAND $__timeFilter(\"time\")\nGROUP BY 1\nORDER BY 1 DESC;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [
        {
          "colorMode": "critical",
          "fill": true,
          "line": true,
          "op": "gt",
          "value": 5,
          "yaxis": "left"
        }
      ],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Consecutive Null Rounds",
      "tooltip": {
        "shared": true,
        "sort": 1,
        "value_type": "individual"
      },
      "transformations": [],
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": 0,
          "format": "none",
          "label": "Number of Null Rounds",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 6,
        "w": 17,
        "x": 0,
        "y": 29
      },
      "hiddenSeries": false,
      "id": 27,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "miner_count",
          "yaxis": 2
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- total network power over time\nwith epoch as (\n    select distinct on (height)\n        time_bucket('30s', to_timestamp(block_headers.timestamp)) as \"time\",\n        --$__timeGroup(blocks.timestamp, '1h'),\n        mpi.state_root\n    from block_headers\n    join miner_pre_commit_infos mpi on height = mpi.pre_commit_epoch\n    where to_timestamp(block_headers.timestamp) > $__timeFrom()\n    AND to_timestamp(block_headers.timestamp) < $__timeTo()\n    group by block_headers.timestamp, mpi.state_root, height\n    order by height, time desc\n)\nselect\n    epoch.time,\n    miner_count,\n    total_raw_bytes_power::numeric,\n    total_qa_bytes_power::numeric\nfrom chain_powers\njoin epoch on epoch.state_root = chain_powers.state_root\norder by time desc;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_block_failure",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Total Network Power over Time",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "decbytes",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "datasource": null,
      "description": "All heights where a series of null rounds were concluded and the height at which they concluded.",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "center",
            "displayMode": "auto"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 7,
        "x": 17,
        "y": 32
      },
      "id": 33,
      "interval": "",
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Consecutive Null Rounds"
          }
        ]
      },
      "pluginVersion": "7.1.5",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "WITH distinct_heights AS (\n\tSELECT DISTINCT\n\t\theight::int AS height\n\tFROM\n\t\tblock_headers\n\tORDER BY\n\t\theight::int DESC\n),\nheight_diffs AS (\n\tSELECT\n\t\theight,\n\t\theight - lag(height) OVER (ORDER BY height) - 1 AS \"consecutive_null_rounds\"\n\tFROM\n\t\tdistinct_heights ORDER BY\n\t\t\theight DESC\n)\nSELECT\n\theight as \"Height\",\n\tconsecutive_null_rounds as \"Consecutive Null Rounds\"\nFROM\n\theight_diffs\nWHERE\n\tconsecutive_null_rounds > 0\nORDER BY 2 DESC\nLIMIT 100;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Top 100 Trends of Consecutive Null Rounds",
      "transformations": [],
      "type": "table"
    },
    {
      "alert": {
        "alertRuleTags": {},
        "conditions": [
          {
            "evaluator": {
              "params": [
                80
              ],
              "type": "lt"
            },
            "operator": {
              "type": "and"
            },
            "query": {
              "params": [
                "A",
                "240h",
                "now"
              ]
            },
            "reducer": {
              "params": [],
              "type": "diff"
            },
            "type": "query"
          }
        ],
        "executionErrorState": "alerting",
        "for": "0m",
        "frequency": "1h",
        "handler": 1,
        "name": "Raw Byte Power Acceleration alert",
        "noDataState": "no_data",
        "notifications": []
      },
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "description": "This panel displays the [percentage change](https://en.wikipedia.org/wiki/Relative_change_and_difference#Percentage_change) of each hour over the last hour of the acceleration (rate of the rate of change) of raw byte power on the Filecoin network. \n\nThe two lines are in fact the same data set but separate over the two y-axis. This allows for the detail between -250% and 250% to be shown clearly, whilst showing the magnitude of the peaks and valleys. This is required due to Grafana not supporting negative log scales [issue](https://github.com/grafana/grafana/issues/7627).",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fill": 0,
      "fillGradient": 1,
      "gridPos": {
        "h": 8,
        "w": 17,
        "x": 0,
        "y": 35
      },
      "hiddenSeries": false,
      "id": 38,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "/zoom-out-.*/",
          "yaxis": 2
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [],
          "hide": true,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "with epoch as (\n    select distinct on (height) height,\n           to_timestamp(timestamp) as \"time\",\n           parent_state_root\n    from block_headers\n    where to_timestamp(timestamp) > date $__timeFrom() - interval '1 day'\n       and to_timestamp(timestamp) < $__timeTo()\n    group by height, timestamp, parent_state_root, parent_weight\n    order by height desc, parent_weight desc\n),\ndata as (\nselect epoch.time,\n        ((total_raw_bytes_power::numeric - lag(total_raw_bytes_power::numeric)\n                                          over (order by epoch.time rows between 1919 preceding and current row)) /\n        extract(epoch from time - (time - interval '8hr')) -\n        (lag(total_raw_bytes_power::numeric, 1920) over w - lag(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 3839 preceding and 1920 preceding)) /\n        extract(epoch from time - (time - interval '8hr'))) /\n               greatest(((lag(total_raw_bytes_power::numeric, 1920) over w - lag(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 3839 preceding and 1920 preceding)) /\n        extract(epoch from time - (time - interval '8hr'))), 1) * 100                                                       as \"zoom-in-8hr\",\n        ((total_raw_bytes_power::numeric - lag(total_raw_bytes_power::numeric)\n                                          over (order by epoch.time rows between 959 preceding and current row)) /\n        extract(epoch from time - (time - interval '8hr')) -\n        (lag(total_raw_bytes_power::numeric, 1920) over w - lag(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 3839 preceding and 1920 preceding)) /\n        extract(epoch from time - (time - interval '8hr'))) /\n               greatest(((lag(total_raw_bytes_power::numeric, 1920) over w - lag(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 3839 preceding and 1920 preceding)) /\n        extract(epoch from time - (time - interval '8hr'))), 1) * 100                                                       as \"zoom-out-8hr\"\nfrom epoch\n         join chain_powers on epoch.parentstateroot = chain_powers.state_root\n    window w as (order by epoch.time)\norder by time desc\n)\nselect * from data\n    where time > $__timeFrom()\n       and time < $__timeTo()\n       order by time desc",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "format": "time_series",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "with epoch as (\n    select distinct on (height) height,\n           to_timestamp(timestamp) as \"time\",\n           parent_state_root\n    from block_headers\n    where to_timestamp(timestamp) > date $__timeFrom() - interval '1 day'\n       and to_timestamp(timestamp) < $__timeTo()\n    group by height, timestamp, parent_state_root, parent_weight\n    order by height desc, parent_weight desc\n),\ndata as (\nselect epoch.time,\n       ((total_raw_bytes_power::numeric - lag(total_raw_bytes_power::numeric)\n                                          over (order by epoch.time rows between 239 preceding and current row)) /\n        extract(epoch from time - (time - interval '2hr')) -\n        (lag(total_raw_bytes_power::numeric, 240) over w - lag(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 479 preceding and 240 preceding)) /\n        extract(epoch from time - (time - interval '2hr')))                                                        as \"zoom-in-2hr\",\n              ((total_raw_bytes_power::numeric - lag(total_raw_bytes_power::numeric)\n                                          over (order by epoch.time rows between 239 preceding and current row)) /\n        extract(epoch from time - (time - interval '2hr')) -\n        (lag(total_raw_bytes_power::numeric, 240) over w - lag(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 479 preceding and 240 preceding)) /\n        extract(epoch from time - (time - interval '2hr')))                                                       as \"zoom-out-2hr\"\nfrom epoch\n         join chain_powers on epoch.parent_state_root = chain_powers.state_root\n    window w as (order by epoch.time)\norder by time desc\n)\nselect * from data\n    where time > $__timeFrom()\n       and time < $__timeTo()\n       order by time desc",
          "refId": "C",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "format": "time_series",
          "group": [],
          "hide": true,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "with epoch as (\n    select distinct on (height) height,\n           to_timestamp(timestamp) as \"time\",\n           parent_state_root\n    from block_headers\n    where to_timestamp(timestamp) > date $__timeFrom() - interval '1 day'\n       and to_timestamp(timestamp) < $__timeTo()\n    group by height, timestamp, parent_state_root, parent_weight\n    order by height desc, parent_weight desc\n),\ndata as (\nselect epoch.time,\n       ((total_raw_bytes_power::numeric - avg(total_raw_bytes_power::numeric)\n                                          over (order by epoch.time rows between 479 preceding and current row)) /\n        extract(epoch from time - (time - interval '4hr')) -\n        (lag(total_raw_bytes_power::numeric, 480) over w - avg(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 959 preceding and 480 preceding)) /\n        extract(epoch from time - (time - interval '4hr'))) /\n               greatest(((lag(total_raw_bytes_power::numeric, 480) over w - avg(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 959 preceding and 480 preceding)) /\n        extract(epoch from time - (time - interval '4hr'))), 1) * 100                                                       as \"zoom-in-4hr\",\n       ((total_raw_bytes_power::numeric - avg(total_raw_bytes_power::numeric)\n                                          over (order by epoch.time rows between 479 preceding and current row)) /\n        extract(epoch from time - (time - interval '4hr')) -\n        (lag(total_raw_bytes_power::numeric, 480) over w - avg(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 959 preceding and 480 preceding)) /\n        extract(epoch from time - (time - interval '4hr'))) /\n               greatest(((lag(total_raw_bytes_power::numeric, 480) over w - avg(total_raw_bytes_power::numeric)\n                                                            over (order by epoch.time rows between 959 preceding and 480 preceding)) /\n        extract(epoch from time - (time - interval '4hr'))), 1) * 100                                                       as \"zoom-out-4hr\"\nfrom epoch\n         join chain_powers on epoch.parent_state_root = chain_powers.state_root\n    window w as (order by epoch.time)\norder by time desc\n)\nselect * from data\n    where time > $__timeFrom()\n       and time < $__timeTo()\n       order by time desc",
          "refId": "D",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [
        {
          "colorMode": "critical",
          "fill": true,
          "line": true,
          "op": "lt",
          "value": 80,
          "yaxis": "left"
        }
      ],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Percentage Change Raw Byte Power Velocity",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "transparent": true,
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": null,
          "format": "percent",
          "label": null,
          "logBase": 1,
          "max": "1000",
          "min": "-1000",
          "show": true
        },
        {
          "format": "percent",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": true,
        "alignLevel": 0
      }
    },
    {
      "aliasColors": {},
      "bars": true,
      "dashLength": 10,
      "dashes": false,
      "datasource": null,
      "decimals": 0,
      "description": "Number of actor messages executed grouped by exit code.",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "links": []
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 7,
        "w": 17,
        "x": 0,
        "y": 43
      },
      "hiddenSeries": false,
      "id": 11,
      "interval": "3s",
      "legend": {
        "alignAsTable": true,
        "avg": true,
        "current": false,
        "max": true,
        "min": true,
        "rightSide": true,
        "show": true,
        "sort": "total",
        "sortDesc": true,
        "total": true,
        "values": true
      },
      "lines": false,
      "linewidth": 1,
      "nullPointMode": "null as zero",
      "percentage": false,
      "pluginVersion": "7.1.5",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": true,
      "steppedLine": false,
      "targets": [
        {
          "format": "time_series",
          "group": [
            {
              "params": [
                "$__interval",
                "none"
              ],
              "type": "time"
            }
          ],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "WITH actor_results as (\n\tSELECT\n\t\ttime_bucket('30s', to_timestamp(\"b\".\"timestamp\")) AS \"time\",\n\t\tconcat(a.code,'/',m.method,' -> ',r.exit_code) AS \"message\"\n\tFROM \"receipts\" r\n\tJOIN \"messages\" m ON r.message = m.cid\n\tJOIN \"block_messages\" bm ON m.cid = bm.message\n\tJOIN \"block_headers\" b ON bm.block = b.cid\n\tJOIN \"actors\" a ON r.state_root = a.state_root AND m.to = a.id\n  WHERE\n    $__unixEpochFilter(\"b\".\"timestamp\")\n\tORDER BY b.height DESC\n) SELECT\n\t$__timeGroupAlias(\"time\",$__interval, 0),\n\tmessage,\n\tcount(message)\nFROM actor_results\nGROUP BY 1, 2\nORDER BY 1, 2",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "column"
              },
              {
                "params": [
                  "avg"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "pledged_collateral"
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "\"chain.economics\"",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Actor Messages with Exitcode",
      "tooltip": {
        "shared": true,
        "sort": 2,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": null,
          "format": "short",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "datasource": null,
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "center"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "PeerID"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 475
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 6,
        "w": 17,
        "x": 0,
        "y": 50
      },
      "id": 36,
      "options": {
        "showHeader": true
      },
      "pluginVersion": "7.1.5",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "with expected_heights as (\n\tselect\n\t\thost,\n\t\tpeer_ID,\n\t\tmax(gauge) as \"height\"\n\tfrom lotus_chain_node_height_expected\n\tgroup by 1, 2\n), actual_heights as (\n\tselect\n\t\thost,\n\t\tpeer_ID,\n\t\tmax(gauge) as \"height\"\n\tfrom lotus_chain_node_height\n\tgroup by 1, 2\n)\nselect\n\ta.host as \"Hostname\",\n\ta.peer_ID as \"PeerID\",\n\ta.height as \"Node Sync Height\",\n\te.height - a.height as \"Sync Lag\"\nfrom actual_heights a JOIN expected_heights e USING (host, peer_ID)\n;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "counter"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "lotus_pubsub_recv_rpc",
          "timeColumn": "\"time\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Network Sync Lag per Host",
      "type": "table"
    }
  ],
  "refresh": false,
  "schemaVersion": 26,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-30m",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "browser",
  "title": "Sentinel (Ignition)",
  "uid": "sentinel_v0_3",
  "version": 44
}
